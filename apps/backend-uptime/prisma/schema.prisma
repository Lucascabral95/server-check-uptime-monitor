generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Status {
  PENDING 
  UP
  DOWN
}

enum Role {
   ADMIN
   USER
   GUEST
}

model User {
  id         String    @id @default(uuid())
  cognitoSub String?   @unique @map("cognito_sub")
  email      String    @unique
  role       Role      @default(USER)
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @default(now()) @map("updated_at")
  monitors   Monitor[]

  @@map("users")
}

model Monitor {
  id        String    @id @default(uuid())
  userId    String    @map("user_id")
  name      String
  url       String
  frequency Int       @default(60)
  
  isActive  Boolean   @default(true) @map("is_active")
  nextCheck DateTime  @default(now()) @map("next_check")
  lastCheck DateTime? @map("last_check")
  status    Status    @default(PENDING)

  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @default(now()) @map("updated_at")

  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  logs      PingLog[]

  @@index([isActive, nextCheck])
  @@map("monitors")
}

model PingLog {
  id         String   @id @default(uuid())
  monitorId  String   @map("monitor_id")
  statusCode Int      @map("status_code")
  durationMs Int      @map("duration_ms")
  error      String?
  timestamp  DateTime @default(now())
  success    Boolean  @default(false)
  
  monitor    Monitor  @relation(fields: [monitorId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @default(now()) @map("updated_at")

  @@index([monitorId, timestamp(sort: Desc)])
  @@index([monitorId, success])
  @@map("ping_logs")
}
